<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>macroid</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="A modular functional user interface creation language for Android, implemented with Scala macros" /><meta name="author" content="macroid" /><meta name="og:image" content="/macroid/img/poster.png" /><meta name="og:title" content="macroid" /><meta name="og:site_name" content="macroid" /><meta name="og:url" content="http://macroid.github.io" /><meta name="og:type" content="website" /><meta name="og:description" content="A modular functional user interface creation language for Android, implemented with Scala macros" /><meta name="twitter:image" content="/macroid/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><link rel="icon" type="image/png" href="/macroid/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css" /><link rel="stylesheet" href="/macroid/css/style.css" /><link rel="stylesheet" href="/macroid/css/palette.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/macroid/" class="brand"><div class="brand-wrapper" style="background:url('/macroid/img/sidebar_brand.png') no-repeat"><span>macroid</span></div></a></li>  <li><a href="/macroid/docs/index.html" class="">Introduction</a>  <li><a href="/macroid/docs/Installation.html" class="">Installation</a> <ul class="sub_section"> <li><a href="/macroid/docs/installation/ScalaOnAndroid.html" class="">Scala on Android</a></li></ul>  <li><a href="/macroid/docs/Tutorial.html" class="">Tutorial</a> <ul class="sub_section"> <li><a href="/macroid/docs/tutorial/BuildingLayouts.html" class="">Building layouts</a></li> <li><a href="/macroid/docs/tutorial/Tweaking.html" class="">Tweaking widgets</a></li> <li><a href="/macroid/docs/tutorial/HandlingEvents.html" class="">Handling events</a></li> <li><a href="/macroid/docs/tutorial/GettingAdaptive.html" class="">Getting adaptive</a></li> <li><a href="/macroid/docs/tutorial/CompleteCode.html" class="">Complete code</a></li></ul>  <li><a href="/macroid/docs/Guide.html" class="">Guide</a> <ul class="sub_section"> <li><a href="/macroid/docs/guide/UiActions.html" class="">UI actions</a></li> <li><a href="/macroid/docs/guide/Contexts.html" class="">Contexts</a></li> <li><a href="/macroid/docs/guide/Bricks.html" class="">Bricks</a></li> <li><a href="/macroid/docs/guide/Tweaks.html" class="">Tweaks</a></li> <li><a href="/macroid/docs/guide/Snails.html" class="">Snails</a></li> <li><a href="/macroid/docs/guide/Transformers.html" class="">Transformers</a></li> <li><a href="/macroid/docs/guide/Operators.html" class="">Understand operators</a></li> <li><a href="/macroid/docs/guide/MediaQueries.html" class="">Media queries</a></li> <li><a href="/macroid/docs/guide/Fragments.html" class="">Fragments</a></li> <li><a href="/macroid/docs/guide/Searching.html" class="">Searching</a></li> <li><a href="/macroid/docs/guide/ToastsDialogs.html" class="">Toasts and dialogs</a></li> <li><a href="/macroid/docs/guide/Advanced.html" class="">Advances techniques</a></li> <li><a href="/macroid/docs/guide/Imports.html" class="">Imports</a></li></ul>  <li><a href="/macroid/docs/Modules.html" class="">Modules</a> <ul class="sub_section"> <li><a href="/macroid/docs/modules/Viewable.html" class="">Viewable</a></li> <li><a href="/macroid/docs/modules/Akka.html" class=" active ">Akka Integration</a></li></ul>  <li><a href="/macroid/docs/Differences.html" class="">Differences from</a> <ul class="sub_section"> <li><a href="/macroid/docs/differences/Vanilla.html" class="">Vanilla Android</a></li> <li><a href="/macroid/docs/differences/Scaloid.html" class="">Scaloid</a></li></ul>  <li><a href="/macroid/docs/Samples.html" class="">Sample Projects</a>  <li><a href="/macroid/docs/Talks.html" class="">Talks</a>  <li><a href="/macroid/docs/Changelog.html" class="">Changelog</a> </li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="hidden-xs"><a href="https://github.com/47deg/macroid"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li class="hidden-xs"><a href="https://github.com/47deg/macroid"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('macroid A modular functional user interface creation language for Android, implemented with Scala macros');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('macroid A modular functional user interface creation language for Android, implemented with Scala macros');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="47deg" data-github-repo="macroid"><div class="content-wrapper"><section><h1 id="akka-integration">Akka Integration</h1>

<p>This module contains some glue to setup message-passing between Android Fragments using <a href="http://akka.io">Akka</a>.</p>

<p>You have to add your version of Akka yourself (see below).</p>

<h2 id="how-to-use">How to use</h2>

<p>Assuming you already have <em>Macroid</em> <code class="highlighter-rouge">2.0.0-M4</code> installed, add this line to your <code class="highlighter-rouge">build.sbt</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="c1">// this library
</span>  <span class="n">aar</span><span class="o">(</span><span class="s">"org.macroid"</span> <span class="o">%%</span> <span class="s">"macroid-akka"</span> <span class="o">%</span> <span class="s">"2.0.0-M4"</span><span class="o">),</span>

  <span class="c1">// akka, if not included before
</span>  <span class="s">"com.typesafe.akka"</span> <span class="o">%%</span> <span class="s">"akka-actor"</span> <span class="o">%</span> <span class="s">"2.3.9"</span>
<span class="o">)</span>

<span class="c1">// Proguard rules
</span><span class="n">proguardOptions</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="s">"-keep class akka.actor.LightArrayRevolverScheduler { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.actor.LocalActorRefProvider { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.actor.CreatorFunctionConsumer { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.actor.TypedCreatorFunctionConsumer { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.dispatch.BoundedDequeBasedMessageQueueSemantics { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.dispatch.UnboundedMessageQueueSemantics { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.dispatch.UnboundedDequeBasedMessageQueueSemantics { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.dispatch.DequeBasedMessageQueueSemantics { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.actor.LocalActorRefProvider$Guardian { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.actor.LocalActorRefProvider$SystemGuardian { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.dispatch.UnboundedMailbox { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.actor.DefaultSupervisorStrategy { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class macroid.akka.AkkaAndroidLogger { *; }"</span><span class="o">,</span>
  <span class="s">"-keep class akka.event.Logging$LogExt { *; }"</span>
<span class="o">)</span>
</code></pre>
</div>

<p>Add to your <code class="highlighter-rouge">Activity</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">macroid.akka.AkkaActivity</span>

<span class="k">class</span> <span class="nc">MyActivity</span> <span class="k">extends</span> <span class="nc">Activity</span> <span class="k">with</span> <span class="nc">AkkaActivity</span> <span class="o">{</span>
  <span class="c1">// define actor system name
</span>  <span class="k">val</span> <span class="n">actorSystemName</span> <span class="k">=</span> <span class="s">"my-system"</span>
  
  <span class="c1">// use the provided actor system to create some actors
</span>  <span class="k">lazy</span> <span class="k">val</span> <span class="n">actor1</span> <span class="k">=</span> <span class="n">actorSystem</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(...,</span> <span class="o">...)</span>
  
  <span class="o">...</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Do not forget to call <code class="highlighter-rouge">actorSystem.shutdown()</code> when the activity is finished.</p>

<p>Now the idea is that we create an actor per each fragment. The actors will live as long as the activity lives.
The fragments, on the other hand, come and go, as they normally do. Thus our actors can be “attached” and “detached”
from the user interface they control.</p>

<p>Here is a fragment actor:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">macroid.akka.FragmentActor</span>
<span class="k">import</span> <span class="nn">macroid.util.Ui</span>

<span class="k">object</span> <span class="nc">MyActor</span> <span class="o">{</span>
  <span class="c1">// this is a common Akka pattern: http://doc.akka.io/docs/akka/snapshot/scala/actors.html
</span>  <span class="c1">// IMPORTANT: notice how we use `new MyActor` and not `Props[MyActor]`
</span>  <span class="c1">// this forces Proguard to keep the class `MyActor`
</span>  <span class="c1">// you might add a Proguard rule as well though
</span>  <span class="k">def</span> <span class="n">props</span> <span class="k">=</span> <span class="nc">Props</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyActor</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">MyActor</span> <span class="k">extends</span> <span class="nc">FragmentActor</span><span class="o">[</span><span class="kt">MyFragment</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// receiveUi handles attaching and detaching UI
</span>  <span class="c1">// and then (sic!) passes the message to us
</span>  <span class="k">def</span> <span class="n">receive</span> <span class="k">=</span> <span class="n">receiveUi</span> <span class="n">andThen</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">MyMessage</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="k">⇒</span> <span class="o">...</span>
    
    <span class="c1">// we can use `withUi`, which will provide us
</span>    <span class="c1">// with the currently attached fragment, if any
</span>    <span class="k">case</span> <span class="nc">MyOtherMessage</span> <span class="k">⇒</span> <span class="n">withUi</span><span class="o">(</span><span class="n">fragment</span> <span class="k">⇒</span> <span class="nc">Ui</span> <span class="o">{</span>
      <span class="c1">// code run on the Ui thread
</span>      <span class="c1">// more about Ui at http://macroid.github.io/guide/UiActions.html
</span>      <span class="o">...</span>
    <span class="o">})</span>

    <span class="c1">// these two are already handled in receiveUi
</span>    <span class="c1">// but you can add your own behavior
</span>    <span class="k">case</span> <span class="nc">FragmentActor</span><span class="o">.</span><span class="nc">AttachUi</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">⇒</span> 
    <span class="k">case</span> <span class="nc">FragmentActor</span><span class="o">.</span><span class="nc">DetachUi</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">⇒</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Finally, a fragment:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">android.support.v4.app.Fragment</span>
<span class="k">import</span> <span class="nn">macroid.akka.AkkaFragment</span>

<span class="k">class</span> <span class="nc">MyFragment</span> <span class="k">extends</span> <span class="nc">Fragment</span> <span class="k">with</span> <span class="nc">AkkaFragment</span> <span class="o">{</span>
  <span class="c1">// find the actor for this fragment
</span>  <span class="c1">// which we created in the Activity
</span>  <span class="c1">// if this fragment does not have a dedicated actor,
</span>  <span class="c1">// set to `None`
</span>  <span class="k">lazy</span> <span class="k">val</span> <span class="n">actor</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">.</span><span class="n">actorSelection</span><span class="o">(</span><span class="s">"/user/actor1"</span><span class="o">))</span>
  
  <span class="o">...</span>
  <span class="c1">// `AkkaFragment` uses “stackable trait” pattern
</span>  <span class="c1">// (http://www.artima.com/scalazine/articles/stackable_trait_pattern.html)
</span>  <span class="c1">// to override `onStart` and `onStop` with attaching and detaching of the actor
</span><span class="o">}</span>
</code></pre>
</div>

<p>There is also an Android-compatible Akka logger. To use it, add to your <code class="highlighter-rouge">src/main/resources/application.conf</code>:
<code class="highlighter-rouge">javascript
akka {
  loggers = ["macroid.akka.AkkaAndroidLogger"]
}
</code></p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/languages/scala.min.js"></script><script src="/macroid/js/main.js"></script></body></html>