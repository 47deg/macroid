<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>macroid</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="A modular functional user interface creation language for Android, implemented with Scala macros" /><meta name="author" content="macroid" /><meta name="og:image" content="/macroid/img/poster.png" /><meta name="og:title" content="macroid" /><meta name="og:site_name" content="macroid" /><meta name="og:url" content="http://macroid.github.io" /><meta name="og:type" content="website" /><meta name="og:description" content="A modular functional user interface creation language for Android, implemented with Scala macros" /><meta name="twitter:image" content="/macroid/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><link rel="icon" type="image/png" href="/macroid/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css" /><link rel="stylesheet" href="/macroid/css/style.css" /><link rel="stylesheet" href="/macroid/css/palette.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/macroid/" class="brand"><div class="brand-wrapper" style="background:url('/macroid/img/sidebar_brand.png') no-repeat"><span>macroid</span></div></a></li>  <li><a href="/macroid/docs/index.html" class="">Introduction</a>  <li><a href="/macroid/docs/Installation.html" class="">Installation</a> <ul class="sub_section"> <li><a href="/macroid/docs/installation/ScalaOnAndroid.html" class="">Scala on Android</a></li></ul>  <li><a href="/macroid/docs/Tutorial.html" class="">Tutorial</a> <ul class="sub_section"> <li><a href="/macroid/docs/tutorial/BuildingLayouts.html" class="">Building layouts</a></li> <li><a href="/macroid/docs/tutorial/Tweaking.html" class="">Tweaking widgets</a></li> <li><a href="/macroid/docs/tutorial/HandlingEvents.html" class="">Handling events</a></li> <li><a href="/macroid/docs/tutorial/GettingAdaptive.html" class="">Getting adaptive</a></li> <li><a href="/macroid/docs/tutorial/CompleteCode.html" class="">Complete code</a></li></ul>  <li><a href="/macroid/docs/Guide.html" class="">Guide</a> <ul class="sub_section"> <li><a href="/macroid/docs/guide/UiActions.html" class="">UI actions</a></li> <li><a href="/macroid/docs/guide/Contexts.html" class="">Contexts</a></li> <li><a href="/macroid/docs/guide/Bricks.html" class="">Bricks</a></li> <li><a href="/macroid/docs/guide/Tweaks.html" class="">Tweaks</a></li> <li><a href="/macroid/docs/guide/Snails.html" class="">Snails</a></li> <li><a href="/macroid/docs/guide/Transformers.html" class="">Transformers</a></li> <li><a href="/macroid/docs/guide/Operators.html" class="">Understand operators</a></li> <li><a href="/macroid/docs/guide/MediaQueries.html" class="">Media queries</a></li> <li><a href="/macroid/docs/guide/Fragments.html" class="">Fragments</a></li> <li><a href="/macroid/docs/guide/Searching.html" class="">Searching</a></li> <li><a href="/macroid/docs/guide/ToastsDialogs.html" class="">Toasts and dialogs</a></li> <li><a href="/macroid/docs/guide/Advanced.html" class="">Advances techniques</a></li> <li><a href="/macroid/docs/guide/Imports.html" class="">Imports</a></li></ul>  <li><a href="/macroid/docs/Modules.html" class="">Modules</a> <ul class="sub_section"> <li><a href="/macroid/docs/modules/Viewable.html" class=" active ">Viewable</a></li> <li><a href="/macroid/docs/modules/Akka.html" class="">Akka Integration</a></li> <li><a href="/macroid/docs/modules/Extras.html" class="">Extras</a></li></ul>  <li><a href="/macroid/docs/Differences.html" class="">Differences from</a> <ul class="sub_section"> <li><a href="/macroid/docs/differences/Vanilla.html" class="">Vanilla Android</a></li> <li><a href="/macroid/docs/differences/Scaloid.html" class="">Scaloid</a></li></ul>  <li><a href="/macroid/docs/Samples.html" class="">Sample Projects</a>  <li><a href="/macroid/docs/Talks.html" class="">Talks</a>  <li><a href="/macroid/docs/Changelog.html" class="">Changelog</a> </li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="hidden-xs"><a href="https://github.com/47deg/macroid"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li class="hidden-xs"><a href="https://github.com/47deg/macroid"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('macroid A modular functional user interface creation language for Android, implemented with Scala macros');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('macroid A modular functional user interface creation language for Android, implemented with Scala macros');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="47deg" data-github-repo="macroid"><div class="content-wrapper"><section><h1 id="macroid-viewable">Macroid-Viewable</h1>

<p>This module provides typeclasses to convert data to Android layouts. It offers three advantages:</p>

<ul>
  <li>A clear way to declare how your data should be displayed</li>
  <li>Boilerplate-free <code>ListAdapter</code>s and <code>PagerAdapter</code>s</li>
  <li><em>Macroid</em>’s trademark emphasis on composability</li>
</ul>

<h2 id="installation">Installation</h2>

<p>Assuming you already have <em>Macroid</em> <code>2.0.0-M4</code> installed, add this line to your <code>build.sbt</code>:</p>

<pre><code class="language-scala">libraryDependencies += aar("org.macroid" %% "macroid-viewable" % "2.0.0-M4")
</code></pre>

<h2 id="viewable">Viewable</h2>

<p>A <em>viewable</em> is an instace of <code>trait Viewable[A, +W &lt;: View]</code> that tells how to display <code>A</code> using <code>W</code>. For example:</p>

<pre><code class="language-scala">import macroid.viewable.Viewable

case class User(name: String)

def userViewable(implicit ctx: ContextWrapper): Viewable[User, TextView] =
  Viewable[User] { user ⇒
    w[TextView] &lt;~ TextTweaks.large &lt;~ text(user.name)
  }
</code></pre>

<p>A good idea is to keep <em>viewables</em> in a separate module of your project and reuse them as much as possible.</p>

<p>Now we can play with the above declaration in two ways:</p>

<h3 id="explicit">Explicit</h3>

<p>Producing a layout:</p>

<pre><code class="language-scala">val view: Ui[TextView] = userViewable.view(User("Nick"))
</code></pre>

<p>Producing a <code>PagerAdapter</code>:</p>

<pre><code class="language-scala">val adapter = userViewable.pagerAdapter(List(
  User("John"),
  User("Michael")))

pager &lt;~ PagerTweaks.adapter(adapter)
</code></pre>

<p>Even more concise:</p>

<pre><code class="language-scala">pager &lt;~ userViewable.pagerAdapterTweak(List(
  User("John"),
  User("Michael")))
</code></pre>

<h3 id="implicit">Implicit</h3>

<p>By declaring your <em>viewable</em> implicitly and importing <code>macroid.viewable._</code>, you can go further:</p>

<pre><code class="language-scala">import macroid.viewable._

implicit val userViewable: Viewable[User, TextView] = ...

// produce a layout
User("Nick").view

// produce an adapter:
List(User("John"), User("Michael")).pagerAdapter

// produce an adapter tweak:
List(User("John"), User("Michael")).pagerAdapterTweak
</code></pre>

<h2 id="listable">Listable</h2>

<p>A <em>listable</em> is an instace of <code>trait Listable[A, W &lt;: View]</code> that tells how to display <code>A</code> using <code>W</code> in two steps:</p>

<p>1) Create an empty layout</p>

<p>2) Fill it with the data</p>

<p>Because of that, <em>listables</em> can be used with <code>ListAdapter</code>s, hence the name. Here is an example:</p>

<pre><code class="language-scala">import macroid.viewable.Listable

case class User(name: String)

def userListable(implicit ctx: ContextWrapper): Listable[User, TextView] =
  Listable[User] {
    // create the layout
    w[TextView] &lt;~ TextTweaks.large
  } { view ⇒ user ⇒
    // fill it with data
    view &lt;~ text(user.name)
  }
</code></pre>

<p>Similarly to <em>viewables</em>, <em>listables</em> can be used both explicitly and implicitly:</p>

<pre><code class="language-scala">import macroid.viewable._

// create a ListAdapter
userListable.listAdapter(User("Terry"), User("Graham"))

// or
List(User("Terry"), User("Graham")).listAdapter

// create a tweak for ListAdapter
userListable.listAdapterTweak(User("Terry"), User("Graham"))

// or
List(User("Terry"), User("Graham")).listAdapterTweak
</code></pre>

<p><code>Listable</code> does not inherit from <code>Viewable</code> directly, because they have different variance in the <code>W</code> parameter, but
it’s possible to convert a <em>listable</em> to a <em>viewable</em>:</p>

<pre><code class="language-scala">userListable.toViewable.view(User("Nick"))
</code></pre>

<p>Additionally, if there is an implicit <code>Listable[A, W]</code>, it can serve as an implicit <code>Viewable[A, W]</code>.</p>

<h2 id="using-combinators">Using combinators</h2>

<p>To ease the task of defining new <em>viewables</em> and <em>listables</em>, the library provides some factory methods
and combinators. We have already seen the direct creation of both <code>Viewable</code> and <code>Listable</code>.
Let’s now look into other means available:</p>

<h3 id="text"><code>text</code></h3>

<p>Creating a <em>viewable</em> or a <em>listable</em> for strings is easy, just provide the styles:</p>

<pre><code class="language-scala">val textViewable: Viewable[String, TextView] = Viewable.text {
  TextTweaks.large + TextTweaks.color(Color.RED)
}

val textListable: Listable[String, TextView] = Listable.text {
  TextTweaks.large + TextTweaks.color(Color.RED)
}
</code></pre>

<h3 id="contramap"><code>contraMap</code></h3>

<p>A <em>viewable</em>/<em>listable</em> for a string does not help much.
But we can use it to build something more complex through delegation:</p>

<pre><code class="language-scala">val userViewable = textViewable.contraMap[User](user ⇒ user.name)
</code></pre>

<p>In other words, if we have a <code>Viewable[A, W]</code> and a function <code>B ⇒ A</code>, we can make <code>Viewable[B, W]</code>. The same applies
to <code>Listable</code>.</p>

<h3 id="listabletw"><code>Listable.tw</code></h3>

<p>The “fill view” step in <em>listables</em> can be defined with a tweak:</p>

<pre><code class="language-scala">case class User(name: String, age: Int)

def userListable(implicit ctx: ContextWrapper) =
  Listable[User].tw {
    // create layout
    w[TextView]
  } { user ⇒
    text(user.name) + TextTweaks.size(user.age + 10)
  }
</code></pre>

<h3 id="listabletr"><code>Listable.tr</code></h3>

<p>Similarly, the same “fill view” step in <em>listables</em> can be defined with a transformer:</p>

<pre><code class="language-scala">case class User(name: String, picture: Bitmap)

def userListable(implicit ctx: ContextWrapper) =
  Listable[User].tr {
    l[HorizontalLinearLayout](
      w[ImageView],
      w[TextView] &lt;~ TextTweaks.large
    )
  }(user ⇒ Transformer {
    case img: ImageView ⇒ img &lt;~ ImageTweaks.bitmap(user.picture)
    case txt: TextView ⇒ txt &lt;~ text(user.name)
  })
</code></pre>

<h3 id="listablewrap"><code>Listable.wrap</code></h3>

<p>It is often required to have the <em>listable</em> enclosed into some container, for example, <code>CardView</code>.
Here’s how this can be done:</p>

<pre><code class="language-scala">def cardListable[A, W &lt;: View](listable: Listable[A, W])(implicit ctx: ContextWrapper) =
  Listable.wrap(listable) { w ⇒
    l[CardView](w) &lt;~ Styles.card
  }
</code></pre>

<h3 id="listablecombine"><code>Listable.combine</code></h3>

<p>Stacking two <em>listables</em> together is another common task. For example, we have a class like this:</p>

<pre><code class="language-scala">case class TimedPicture(timestamp: Long, picture: Bitmap)
</code></pre>

<p>and we have already defined <em>listables</em> for <code>Long</code> and <code>Bitmap</code>. To combine them:</p>

<pre><code class="language-scala">// this will be a Listable[(Long, Bitmap), View]
def combinedListable(implicit ctx: ContextWrapper) =
  Listable.combine(timestampListable, pictureListable) { (t, p) ⇒
    l[VerticalLinearLayout](t, p)
  }

// now convert it to Listable[TimedPicture, View]
def timedPictureListable =
  combinedListable.contraMap[TimedPicture] { tp ⇒
    (tp.timestamp, tp.picture)
  }
</code></pre>

<h2 id="slotted-listable">Slotted listable</h2>

<p><code>SlottedListable</code> implements the well-known
<a href="http://developer.android.com/training/improving-layouts/smooth-scrolling.html#ViewHolder">holder pattern</a>,
but in true <em>Macroid</em> style. It’s often what you want to use when the list element has two or more widgets.
Let’s jump straight to the code:</p>

<pre><code class="language-scala">case class User(name: String, picture: Bitmap)

object UserListable extends SlottedListable[User] {
  // our ViewHolder
  class Slots {
    var name = slot[TextView]
    var picture = slot[ImageView]
  }
  
  // now we just need to implement two abstract methods of SlottedListable:

  // make and wire the slots
  def makeSlots(viewType: Int)(implicit ctx: ContextWrapper) = {
    val slots = new Slots
    val view = l[LinearLayout](
      w[ImageView] &lt;~ wire(slots.picture),
      w[TextView] &lt;~ wire(slots.name)
    )
    (view, slots)
  }

  // fill the slots
  def fillSlots(slots: Slots, data: User)(implicit ctx: ContextWrapper) = {
    (slots.name &lt;~ text(data.name)) ~
    (slots.picture &lt;~ data.picture)
  }
}
</code></pre>

<h2 id="composing-from-alternatives">Composing from alternatives</h2>

<p>Both <em>viewables</em> and <em>listables</em> support composition from alternatives — the most
obvious use-case is joining several layout types in one. Everything below applies to
both <code>Viewable</code> and <code>Listable</code>, but we’ll proceed with just <code>Viewable</code> for simplicity.</p>

<p>Consider this toy “Macroid Now” example:</p>

<pre><code class="language-scala">sealed trait MacroidNowCard

case class Weather(temp: Float) extends MacroidNowCard

case class PhotosNearby(photos: List[URL]) extends MacroidNowCard
</code></pre>

<p>Now suppose we have defined these:</p>

<pre><code class="language-scala">val weatherViewable: Viewable[Weather, CardView] = ...
val photosNearbyViewable: Viewable[PhotosNearby, CardView] = ...
</code></pre>

<p>How do we define this?</p>

<pre><code class="language-scala">val macroidNowViewable: Viewable[MacroidNowCard, CardView] = ???
</code></pre>

<p>This is where <code>PartialViewable</code> comes into play: it’s a <em>viewable</em>,
which is defined only for a certain subset of the data. <em>Partial viewables</em>
can be combined with the <code>orElse</code> operator, much like Scala’s <code>PartialFunction</code>s.</p>

<p>A <em>partial viewable</em> can be obtained in a few ways:</p>

<pre><code class="language-scala">// this will give a PartialViewable[Weather, CardView],
// which is only defined for really hot days
weatherViewable.cond(_.temp &gt; 40)

// this will give a PartialViewable[MacroidNowCard, CardView],
// which is only defined for cards that are instanceOf[Weather]
weatherViewable.toParent[MacroidNowCard]
</code></pre>

<p>The solution is thus to convert both our <em>viewables</em> to <em>partial viewables</em>,
combine them, and go back to the normal (or <em>total</em>) <em>viewable</em>:</p>

<pre><code class="language-scala">val macroidNowViewable = {
  weatherViewable.toParent[MacroidNowCard] orElse
  photosNearbyViewable.toParent[MacroidNowCard]
}.toTotal
</code></pre>

<p>Finally, keep in mind that <code>Listable</code> provides exactly the same API.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/languages/scala.min.js"></script><script src="/macroid/js/main.js"></script></body></html>