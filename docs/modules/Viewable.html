<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>macroid</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="A modular functional user interface creation language for Android, implemented with Scala macros" /><meta name="author" content="macroid" /><meta name="og:image" content="/macroid/img/poster.png" /><meta name="og:title" content="macroid" /><meta name="og:site_name" content="macroid" /><meta name="og:url" content="http://macroid.github.io" /><meta name="og:type" content="website" /><meta name="og:description" content="A modular functional user interface creation language for Android, implemented with Scala macros" /><meta name="twitter:image" content="/macroid/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><link rel="icon" type="image/png" href="/macroid/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css" /><link rel="stylesheet" href="/macroid/css/style.css" /><link rel="stylesheet" href="/macroid/css/palette.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/macroid/" class="brand"><div class="brand-wrapper" style="background:url('/macroid/img/sidebar_brand.png') no-repeat"><span>macroid</span></div></a></li>  <li><a href="/macroid/docs/index.html" class="">Introduction</a>  <li><a href="/macroid/docs/Installation.html" class="">Installation</a> <ul class="sub_section"> <li><a href="/macroid/docs/installation/ScalaOnAndroid.html" class="">Scala on Android</a></li></ul>  <li><a href="/macroid/docs/Tutorial.html" class="">Tutorial</a> <ul class="sub_section"> <li><a href="/macroid/docs/tutorial/BuildingLayouts.html" class="">Building layouts</a></li> <li><a href="/macroid/docs/tutorial/Tweaking.html" class="">Tweaking widgets</a></li> <li><a href="/macroid/docs/tutorial/HandlingEvents.html" class="">Handling events</a></li> <li><a href="/macroid/docs/tutorial/GettingAdaptive.html" class="">Getting adaptive</a></li> <li><a href="/macroid/docs/tutorial/CompleteCode.html" class="">Complete code</a></li></ul>  <li><a href="/macroid/docs/Guide.html" class="">Guide</a> <ul class="sub_section"> <li><a href="/macroid/docs/guide/UiActions.html" class="">UI actions</a></li> <li><a href="/macroid/docs/guide/Contexts.html" class="">Contexts</a></li> <li><a href="/macroid/docs/guide/Bricks.html" class="">Bricks</a></li> <li><a href="/macroid/docs/guide/Tweaks.html" class="">Tweaks</a></li> <li><a href="/macroid/docs/guide/Snails.html" class="">Snails</a></li> <li><a href="/macroid/docs/guide/Transformers.html" class="">Transformers</a></li> <li><a href="/macroid/docs/guide/Operators.html" class="">Understand operators</a></li> <li><a href="/macroid/docs/guide/MediaQueries.html" class="">Media queries</a></li> <li><a href="/macroid/docs/guide/Fragments.html" class="">Fragments</a></li> <li><a href="/macroid/docs/guide/Searching.html" class="">Searching</a></li> <li><a href="/macroid/docs/guide/ToastsDialogs.html" class="">Toasts and dialogs</a></li> <li><a href="/macroid/docs/guide/Advanced.html" class="">Advances techniques</a></li> <li><a href="/macroid/docs/guide/Imports.html" class="">Imports</a></li></ul>  <li><a href="/macroid/docs/Modules.html" class="">Modules</a> <ul class="sub_section"> <li><a href="/macroid/docs/modules/Viewable.html" class=" active ">Viewable</a></li> <li><a href="/macroid/docs/modules/Akka.html" class="">Akka Integration</a></li></ul>  <li><a href="/macroid/docs/Differences.html" class="">Differences from</a> <ul class="sub_section"> <li><a href="/macroid/docs/differences/Vanilla.html" class="">Vanilla Android</a></li> <li><a href="/macroid/docs/differences/Scaloid.html" class="">Scaloid</a></li></ul>  <li><a href="/macroid/docs/Samples.html" class="">Sample Projects</a>  <li><a href="/macroid/docs/Talks.html" class="">Talks</a>  <li><a href="/macroid/docs/Changelog.html" class="">Changelog</a> </li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="hidden-xs"><a href="https://github.com/47deg/macroid"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li class="hidden-xs"><a href="https://github.com/47deg/macroid"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('macroid A modular functional user interface creation language for Android, implemented with Scala macros');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('macroid A modular functional user interface creation language for Android, implemented with Scala macros');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="47deg" data-github-repo="macroid"><div class="content-wrapper"><section><h1 id="macroid-viewable">Macroid-Viewable</h1>

<p>This module provides typeclasses to convert data to Android layouts. It offers three advantages:</p>

<ul>
  <li>A clear way to declare how your data should be displayed</li>
  <li>Boilerplate-free <code class="highlighter-rouge">ListAdapter</code>s and <code class="highlighter-rouge">PagerAdapter</code>s</li>
  <li><em>Macroid</em>’s trademark emphasis on composability</li>
</ul>

<h2 id="installation">Installation</h2>

<p>Assuming you already have <em>Macroid</em> <code class="highlighter-rouge">2.0.0-M4</code> installed, add this line to your <code class="highlighter-rouge">build.sbt</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="n">aar</span><span class="o">(</span><span class="s">"org.macroid"</span> <span class="o">%%</span> <span class="s">"macroid-viewable"</span> <span class="o">%</span> <span class="s">"2.0.0-M4"</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="viewable">Viewable</h2>

<p>A <em>viewable</em> is an instace of <code class="highlighter-rouge">trait Viewable[A, +W &lt;: View]</code> that tells how to display <code class="highlighter-rouge">A</code> using <code class="highlighter-rouge">W</code>. For example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">macroid.viewable.Viewable</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">def</span> <span class="n">userViewable</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">ContextWrapper</span><span class="o">)</span><span class="k">:</span> <span class="kt">Viewable</span><span class="o">[</span><span class="kt">User</span>, <span class="kt">TextView</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Viewable</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="o">{</span> <span class="n">user</span> <span class="k">⇒</span>
    <span class="n">w</span><span class="o">[</span><span class="kt">TextView</span><span class="o">]</span> <span class="o">&lt;~</span> <span class="nc">TextTweaks</span><span class="o">.</span><span class="n">large</span> <span class="o">&lt;~</span> <span class="n">text</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre>
</div>

<p>A good idea is to keep <em>viewables</em> in a separate module of your project and reuse them as much as possible.</p>

<p>Now we can play with the above declaration in two ways:</p>

<h3 id="explicit">Explicit</h3>

<p>Producing a layout:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">view</span><span class="k">:</span> <span class="kt">Ui</span><span class="o">[</span><span class="kt">TextView</span><span class="o">]</span> <span class="k">=</span> <span class="n">userViewable</span><span class="o">.</span><span class="n">view</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"Nick"</span><span class="o">))</span>
</code></pre>
</div>

<p>Producing a <code class="highlighter-rouge">PagerAdapter</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">adapter</span> <span class="k">=</span> <span class="n">userViewable</span><span class="o">.</span><span class="n">pagerAdapter</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span>
  <span class="nc">User</span><span class="o">(</span><span class="s">"John"</span><span class="o">),</span>
  <span class="nc">User</span><span class="o">(</span><span class="s">"Michael"</span><span class="o">)))</span>

<span class="n">pager</span> <span class="o">&lt;~</span> <span class="nc">PagerTweaks</span><span class="o">.</span><span class="n">adapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">)</span>
</code></pre>
</div>

<p>Even more concise:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">pager</span> <span class="o">&lt;~</span> <span class="n">userViewable</span><span class="o">.</span><span class="n">pagerAdapterTweak</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span>
  <span class="nc">User</span><span class="o">(</span><span class="s">"John"</span><span class="o">),</span>
  <span class="nc">User</span><span class="o">(</span><span class="s">"Michael"</span><span class="o">)))</span>
</code></pre>
</div>

<h3 id="implicit">Implicit</h3>

<p>By declaring your <em>viewable</em> implicitly and importing <code class="highlighter-rouge">macroid.viewable._</code>, you can go further:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">macroid.viewable._</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">userViewable</span><span class="k">:</span> <span class="kt">Viewable</span><span class="o">[</span><span class="kt">User</span>, <span class="kt">TextView</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// produce a layout
</span><span class="nc">User</span><span class="o">(</span><span class="s">"Nick"</span><span class="o">).</span><span class="n">view</span>

<span class="c1">// produce an adapter:
</span><span class="nc">List</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"John"</span><span class="o">),</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Michael"</span><span class="o">)).</span><span class="n">pagerAdapter</span>

<span class="c1">// produce an adapter tweak:
</span><span class="nc">List</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"John"</span><span class="o">),</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Michael"</span><span class="o">)).</span><span class="n">pagerAdapterTweak</span>
</code></pre>
</div>

<h2 id="listable">Listable</h2>

<p>A <em>listable</em> is an instace of <code class="highlighter-rouge">trait Listable[A, W &lt;: View]</code> that tells how to display <code class="highlighter-rouge">A</code> using <code class="highlighter-rouge">W</code> in two steps:</p>

<p>1) Create an empty layout</p>

<p>2) Fill it with the data</p>

<p>Because of that, <em>listables</em> can be used with <code class="highlighter-rouge">ListAdapter</code>s, hence the name. Here is an example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">macroid.viewable.Listable</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">def</span> <span class="n">userListable</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">ContextWrapper</span><span class="o">)</span><span class="k">:</span> <span class="kt">Listable</span><span class="o">[</span><span class="kt">User</span>, <span class="kt">TextView</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Listable</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="o">{</span>
    <span class="c1">// create the layout
</span>    <span class="n">w</span><span class="o">[</span><span class="kt">TextView</span><span class="o">]</span> <span class="o">&lt;~</span> <span class="nc">TextTweaks</span><span class="o">.</span><span class="n">large</span>
  <span class="o">}</span> <span class="o">{</span> <span class="n">view</span> <span class="k">⇒</span> <span class="n">user</span> <span class="k">⇒</span>
    <span class="c1">// fill it with data
</span>    <span class="n">view</span> <span class="o">&lt;~</span> <span class="n">text</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre>
</div>

<p>Similarly to <em>viewables</em>, <em>listables</em> can be used both explicitly and implicitly:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">macroid.viewable._</span>

<span class="c1">// create a ListAdapter
</span><span class="n">userListable</span><span class="o">.</span><span class="n">listAdapter</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"Terry"</span><span class="o">),</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Graham"</span><span class="o">))</span>

<span class="c1">// or
</span><span class="nc">List</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"Terry"</span><span class="o">),</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Graham"</span><span class="o">)).</span><span class="n">listAdapter</span>

<span class="c1">// create a tweak for ListAdapter
</span><span class="n">userListable</span><span class="o">.</span><span class="n">listAdapterTweak</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"Terry"</span><span class="o">),</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Graham"</span><span class="o">))</span>

<span class="c1">// or
</span><span class="nc">List</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"Terry"</span><span class="o">),</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Graham"</span><span class="o">)).</span><span class="n">listAdapterTweak</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">Listable</code> does not inherit from <code class="highlighter-rouge">Viewable</code> directly, because they have different variance in the <code class="highlighter-rouge">W</code> parameter, but
it’s possible to convert a <em>listable</em> to a <em>viewable</em>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">userListable</span><span class="o">.</span><span class="n">toViewable</span><span class="o">.</span><span class="n">view</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"Nick"</span><span class="o">))</span>
</code></pre>
</div>

<p>Additionally, if there is an implicit <code class="highlighter-rouge">Listable[A, W]</code>, it can serve as an implicit <code class="highlighter-rouge">Viewable[A, W]</code>.</p>

<h2 id="using-combinators">Using combinators</h2>

<p>To ease the task of defining new <em>viewables</em> and <em>listables</em>, the library provides some factory methods
and combinators. We have already seen the direct creation of both <code class="highlighter-rouge">Viewable</code> and <code class="highlighter-rouge">Listable</code>.
Let’s now look into other means available:</p>

<h3 id="text"><code class="highlighter-rouge">text</code></h3>

<p>Creating a <em>viewable</em> or a <em>listable</em> for strings is easy, just provide the styles:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">textViewable</span><span class="k">:</span> <span class="kt">Viewable</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">TextView</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Viewable</span><span class="o">.</span><span class="n">text</span> <span class="o">{</span>
  <span class="nc">TextTweaks</span><span class="o">.</span><span class="n">large</span> <span class="o">+</span> <span class="nc">TextTweaks</span><span class="o">.</span><span class="n">color</span><span class="o">(</span><span class="nc">Color</span><span class="o">.</span><span class="nc">RED</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">textListable</span><span class="k">:</span> <span class="kt">Listable</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">TextView</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Listable</span><span class="o">.</span><span class="n">text</span> <span class="o">{</span>
  <span class="nc">TextTweaks</span><span class="o">.</span><span class="n">large</span> <span class="o">+</span> <span class="nc">TextTweaks</span><span class="o">.</span><span class="n">color</span><span class="o">(</span><span class="nc">Color</span><span class="o">.</span><span class="nc">RED</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="contramap"><code class="highlighter-rouge">contraMap</code></h3>

<p>A <em>viewable</em>/<em>listable</em> for a string does not help much.
But we can use it to build something more complex through delegation:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">userViewable</span> <span class="k">=</span> <span class="n">textViewable</span><span class="o">.</span><span class="n">contraMap</span><span class="o">[</span><span class="kt">User</span><span class="o">](</span><span class="n">user</span> <span class="k">⇒</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
</code></pre>
</div>

<p>In other words, if we have a <code class="highlighter-rouge">Viewable[A, W]</code> and a function <code class="highlighter-rouge">B ⇒ A</code>, we can make <code class="highlighter-rouge">Viewable[B, W]</code>. The same applies
to <code class="highlighter-rouge">Listable</code>.</p>

<h3 id="listabletw"><code class="highlighter-rouge">Listable.tw</code></h3>

<p>The “fill view” step in <em>listables</em> can be defined with a tweak:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

<span class="k">def</span> <span class="n">userListable</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">ContextWrapper</span><span class="o">)</span> <span class="k">=</span>
  <span class="nc">Listable</span><span class="o">[</span><span class="kt">User</span><span class="o">].</span><span class="n">tw</span> <span class="o">{</span>
    <span class="c1">// create layout
</span>    <span class="n">w</span><span class="o">[</span><span class="kt">TextView</span><span class="o">]</span>
  <span class="o">}</span> <span class="o">{</span> <span class="n">user</span> <span class="k">⇒</span>
    <span class="n">text</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">)</span> <span class="o">+</span> <span class="nc">TextTweaks</span><span class="o">.</span><span class="n">size</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="n">age</span> <span class="o">+</span> <span class="mi">10</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre>
</div>

<h3 id="listabletr"><code class="highlighter-rouge">Listable.tr</code></h3>

<p>Similarly, the same “fill view” step in <em>listables</em> can be defined with a transformer:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">picture</span><span class="k">:</span> <span class="kt">Bitmap</span><span class="o">)</span>

<span class="k">def</span> <span class="n">userListable</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">ContextWrapper</span><span class="o">)</span> <span class="k">=</span>
  <span class="nc">Listable</span><span class="o">[</span><span class="kt">User</span><span class="o">].</span><span class="n">tr</span> <span class="o">{</span>
    <span class="n">l</span><span class="o">[</span><span class="kt">HorizontalLinearLayout</span><span class="o">](</span>
      <span class="n">w</span><span class="o">[</span><span class="kt">ImageView</span><span class="o">],</span>
      <span class="n">w</span><span class="o">[</span><span class="kt">TextView</span><span class="o">]</span> <span class="o">&lt;~</span> <span class="nc">TextTweaks</span><span class="o">.</span><span class="n">large</span>
    <span class="o">)</span>
  <span class="o">}(</span><span class="n">user</span> <span class="k">⇒</span> <span class="nc">Transformer</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">img</span><span class="k">:</span> <span class="kt">ImageView</span> <span class="k">⇒</span> <span class="kt">img</span> <span class="kt">&lt;~</span> <span class="kt">ImageTweaks.bitmap</span><span class="o">(</span><span class="kt">user.picture</span><span class="o">)</span>
    <span class="kt">case</span> <span class="kt">txt:</span> <span class="kt">TextView</span> <span class="k">⇒</span> <span class="kt">txt</span> <span class="kt">&lt;~</span> <span class="kt">text</span><span class="o">(</span><span class="kt">user.name</span><span class="o">)</span>
  <span class="o">})</span>
</code></pre>
</div>

<h3 id="listablewrap"><code class="highlighter-rouge">Listable.wrap</code></h3>

<p>It is often required to have the <em>listable</em> enclosed into some container, for example, <code class="highlighter-rouge">CardView</code>.
Here’s how this can be done:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">cardListable</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">W</span> <span class="k">&lt;:</span> <span class="kt">View</span><span class="o">](</span><span class="n">listable</span><span class="k">:</span> <span class="kt">Listable</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">W</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">ContextWrapper</span><span class="o">)</span> <span class="k">=</span>
  <span class="nc">Listable</span><span class="o">.</span><span class="n">wrap</span><span class="o">(</span><span class="n">listable</span><span class="o">)</span> <span class="o">{</span> <span class="n">w</span> <span class="k">⇒</span>
    <span class="n">l</span><span class="o">[</span><span class="kt">CardView</span><span class="o">](</span><span class="n">w</span><span class="o">)</span> <span class="o">&lt;~</span> <span class="nc">Styles</span><span class="o">.</span><span class="n">card</span>
  <span class="o">}</span>
</code></pre>
</div>

<h3 id="listablecombine"><code class="highlighter-rouge">Listable.combine</code></h3>

<p>Stacking two <em>listables</em> together is another common task. For example, we have a class like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">TimedPicture</span><span class="o">(</span><span class="n">timestamp</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">picture</span><span class="k">:</span> <span class="kt">Bitmap</span><span class="o">)</span>
</code></pre>
</div>

<p>and we have already defined <em>listables</em> for <code class="highlighter-rouge">Long</code> and <code class="highlighter-rouge">Bitmap</code>. To combine them:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// this will be a Listable[(Long, Bitmap), View]
</span><span class="k">def</span> <span class="n">combinedListable</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">ContextWrapper</span><span class="o">)</span> <span class="k">=</span>
  <span class="nc">Listable</span><span class="o">.</span><span class="n">combine</span><span class="o">(</span><span class="n">timestampListable</span><span class="o">,</span> <span class="n">pictureListable</span><span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span> <span class="k">⇒</span>
    <span class="n">l</span><span class="o">[</span><span class="kt">VerticalLinearLayout</span><span class="o">](</span><span class="n">t</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span>
  <span class="o">}</span>

<span class="c1">// now convert it to Listable[TimedPicture, View]
</span><span class="k">def</span> <span class="n">timedPictureListable</span> <span class="k">=</span>
  <span class="n">combinedListable</span><span class="o">.</span><span class="n">contraMap</span><span class="o">[</span><span class="kt">TimedPicture</span><span class="o">]</span> <span class="o">{</span> <span class="n">tp</span> <span class="k">⇒</span>
    <span class="o">(</span><span class="n">tp</span><span class="o">.</span><span class="n">timestamp</span><span class="o">,</span> <span class="n">tp</span><span class="o">.</span><span class="n">picture</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre>
</div>

<h2 id="slotted-listable">Slotted listable</h2>

<p><code class="highlighter-rouge">SlottedListable</code> implements the well-known
<a href="http://developer.android.com/training/improving-layouts/smooth-scrolling.html#ViewHolder">holder pattern</a>,
but in true <em>Macroid</em> style. It’s often what you want to use when the list element has two or more widgets.
Let’s jump straight to the code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">picture</span><span class="k">:</span> <span class="kt">Bitmap</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">UserListable</span> <span class="k">extends</span> <span class="nc">SlottedListable</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// our ViewHolder
</span>  <span class="k">class</span> <span class="nc">Slots</span> <span class="o">{</span>
    <span class="k">var</span> <span class="n">name</span> <span class="k">=</span> <span class="n">slot</span><span class="o">[</span><span class="kt">TextView</span><span class="o">]</span>
    <span class="k">var</span> <span class="n">picture</span> <span class="k">=</span> <span class="n">slot</span><span class="o">[</span><span class="kt">ImageView</span><span class="o">]</span>
  <span class="o">}</span>
  
  <span class="c1">// now we just need to implement two abstract methods of SlottedListable:
</span>
  <span class="c1">// make and wire the slots
</span>  <span class="k">def</span> <span class="n">makeSlots</span><span class="o">(</span><span class="n">viewType</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">ContextWrapper</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">slots</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Slots</span>
    <span class="k">val</span> <span class="n">view</span> <span class="k">=</span> <span class="n">l</span><span class="o">[</span><span class="kt">LinearLayout</span><span class="o">](</span>
      <span class="n">w</span><span class="o">[</span><span class="kt">ImageView</span><span class="o">]</span> <span class="o">&lt;~</span> <span class="n">wire</span><span class="o">(</span><span class="n">slots</span><span class="o">.</span><span class="n">picture</span><span class="o">),</span>
      <span class="n">w</span><span class="o">[</span><span class="kt">TextView</span><span class="o">]</span> <span class="o">&lt;~</span> <span class="n">wire</span><span class="o">(</span><span class="n">slots</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
    <span class="o">)</span>
    <span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">slots</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="c1">// fill the slots
</span>  <span class="k">def</span> <span class="n">fillSlots</span><span class="o">(</span><span class="n">slots</span><span class="k">:</span> <span class="kt">Slots</span><span class="o">,</span> <span class="n">data</span><span class="k">:</span> <span class="kt">User</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ctx</span><span class="k">:</span> <span class="kt">ContextWrapper</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="o">(</span><span class="n">slots</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;~</span> <span class="n">text</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="n">name</span><span class="o">))</span> <span class="o">~</span>
    <span class="o">(</span><span class="n">slots</span><span class="o">.</span><span class="n">picture</span> <span class="o">&lt;~</span> <span class="n">data</span><span class="o">.</span><span class="n">picture</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="composing-from-alternatives">Composing from alternatives</h2>

<p>Both <em>viewables</em> and <em>listables</em> support composition from alternatives — the most
obvious use-case is joining several layout types in one. Everything below applies to
both <code class="highlighter-rouge">Viewable</code> and <code class="highlighter-rouge">Listable</code>, but we’ll proceed with just <code class="highlighter-rouge">Viewable</code> for simplicity.</p>

<p>Consider this toy “Macroid Now” example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">MacroidNowCard</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Weather</span><span class="o">(</span><span class="n">temp</span><span class="k">:</span> <span class="kt">Float</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">MacroidNowCard</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">PhotosNearby</span><span class="o">(</span><span class="n">photos</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">URL</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">MacroidNowCard</span>
</code></pre>
</div>

<p>Now suppose we have defined these:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">weatherViewable</span><span class="k">:</span> <span class="kt">Viewable</span><span class="o">[</span><span class="kt">Weather</span>, <span class="kt">CardView</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>
<span class="k">val</span> <span class="n">photosNearbyViewable</span><span class="k">:</span> <span class="kt">Viewable</span><span class="o">[</span><span class="kt">PhotosNearby</span>, <span class="kt">CardView</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>
</code></pre>
</div>

<p>How do we define this?</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">macroidNowViewable</span><span class="k">:</span> <span class="kt">Viewable</span><span class="o">[</span><span class="kt">MacroidNowCard</span>, <span class="kt">CardView</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</code></pre>
</div>

<p>This is where <code class="highlighter-rouge">PartialViewable</code> comes into play: it’s a <em>viewable</em>,
which is defined only for a certain subset of the data. <em>Partial viewables</em>
can be combined with the <code class="highlighter-rouge">orElse</code> operator, much like Scala’s <code class="highlighter-rouge">PartialFunction</code>s.</p>

<p>A <em>partial viewable</em> can be obtained in a few ways:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// this will give a PartialViewable[Weather, CardView],
// which is only defined for really hot days
</span><span class="n">weatherViewable</span><span class="o">.</span><span class="n">cond</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="o">)</span>

<span class="c1">// this will give a PartialViewable[MacroidNowCard, CardView],
// which is only defined for cards that are instanceOf[Weather]
</span><span class="n">weatherViewable</span><span class="o">.</span><span class="n">toParent</span><span class="o">[</span><span class="kt">MacroidNowCard</span><span class="o">]</span>
</code></pre>
</div>

<p>The solution is thus to convert both our <em>viewables</em> to <em>partial viewables</em>,
combine them, and go back to the normal (or <em>total</em>) <em>viewable</em>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">macroidNowViewable</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">weatherViewable</span><span class="o">.</span><span class="n">toParent</span><span class="o">[</span><span class="kt">MacroidNowCard</span><span class="o">]</span> <span class="n">orElse</span>
  <span class="n">photosNearbyViewable</span><span class="o">.</span><span class="n">toParent</span><span class="o">[</span><span class="kt">MacroidNowCard</span><span class="o">]</span>
<span class="o">}.</span><span class="n">toTotal</span>
</code></pre>
</div>

<p>Finally, keep in mind that <code class="highlighter-rouge">Listable</code> provides exactly the same API.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/languages/scala.min.js"></script><script src="/macroid/js/main.js"></script></body></html>